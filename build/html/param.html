<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ParametrizationDefinition &mdash; py_neuromodulation  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Analyzing sharpwave temporal features" href="example_sharpwave_analysis.html" />
    <link rel="prev" title="ECoG Movement decoding example" href="example_BIDS.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> py_neuromodulation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="first_demo.html">First Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_BIDS.html">ECoG Movement decoding example</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ParametrizationDefinition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preprocessing">Preprocessing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#resampling">Resampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#notch-filtering">Notch Filtering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rereferencing">Rereferencing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#normalization">Normalization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#oscillatory-features">Oscillatory Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#raw-signals">Raw signals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#characterization-of-spectral-aperiodic-component">Characterization of spectral aperiodic component</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nonlinear-measres-for-dynamical-systems-nolds">Nonlinear measres for dynamical systems (nolds)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#coherence">coherence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bursts">Bursts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mne-connectivity">MNE-connectivity</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#postprocessing">Postprocessing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#projection">Projection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="example_sharpwave_analysis.html">Analyzing sharpwave temporal features</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_gridPointProjection.html">Grid Point Projection</a></li>
<li class="toctree-l2"><a class="reference internal" href="rmap_decoding.html">Across patient decoding using R-Map optimal connectivity</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="outline_parametrization.html">Parametrization</a></li>
<li class="toctree-l1"><a class="reference internal" href="outline_featureestimation.html">Feature Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="outline_analysis.html">Analysis</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">py_neuromodulation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="examples.html">Examples</a></li>
      <li class="breadcrumb-item active">ParametrizationDefinition</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/param.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="parametrizationdefinition">
<h1>ParametrizationDefinition<a class="headerlink" href="#parametrizationdefinition" title="Permalink to this heading"></a></h1>
<p>In order to estimate multimodal features of neurophysiological data, certain parametrization steps are required.
Here the following two parametrization files are explained:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nm_settings.json</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nm_channels.csv</span></code></p></li>
</ul>
<section id="preprocessing">
<h2>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this heading"></a></h2>
<p>The following preprocessing options can be written in the <em>preprocessing</em> field, <strong>which will be executed in the specified order</strong>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;documentation_preprocessing_options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;raw_resampling&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;notch_filter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;re_referencing&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;raw_normalization&quot;</span>
<span class="p">],</span>
</pre></div>
</div>
<section id="resampling">
<h3>Resampling<a class="headerlink" href="#resampling" title="Permalink to this heading"></a></h3>
<p><strong>raw_resampling</strong> defines a resampling rate to which the original data is downsampled to. This can be of advantage, since high sampling frequencies automatically require usually more computational cost. In the method specific settings the resampling frequency can be defined:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;raw_resampling_settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;resample_freq_hz&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="notch-filtering">
<h3>Notch Filtering<a class="headerlink" href="#notch-filtering" title="Permalink to this heading"></a></h3>
<p><strong>notch_filer</strong> is a simple setting that filters at the specified <em>line_noise</em> frequency supplied to the <em>Stream</em> class.</p>
</section>
<section id="rereferencing">
<h3>Rereferencing<a class="headerlink" href="#rereferencing" title="Permalink to this heading"></a></h3>
<p><strong>rereferencing</strong> constitutes an important aspect of electrophysiological signal processing. Most commonly bipolar and common average rereferencing are applied for separate channel modalities. The channel specific <em>rereferencing</em> is specified in the  <em>nm_channels</em> dataframe in the <em>rereference</em> column, with the following possible combinations:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Rereference Type</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>average</p></td>
<td><p>common average rereference (across a channel type, e.g. ecog or eeg)</p></td>
<td><p><em>average</em></p></td>
</tr>
<tr class="row-odd"><td><p>bipolar</p></td>
<td><p>bipolar rereferencing, by specifying the channel name to rereference to</p></td>
<td><p><em>LFP_RIGHT_0</em></p></td>
</tr>
<tr class="row-even"><td><p>combination</p></td>
<td><p>combination of different channels separated by “&amp;” can also be used</p></td>
<td><p><em>LFP_RIGHT_0&amp;LFP_RIGHT_1</em></p></td>
</tr>
<tr class="row-odd"><td><p>none</p></td>
<td><p>no rereferencing being used for this particular channel</p></td>
<td><p><em>none</em></p></td>
</tr>
</tbody>
</table>
</section>
<section id="normalization">
<h3>Normalization<a class="headerlink" href="#normalization" title="Permalink to this heading"></a></h3>
<p><strong>normalization</strong> allows for normalizing the past <em>normalization_time</em> according to the following options:</p>
<ul class="simple">
<li><p>mean</p></li>
<li><p>median</p></li>
<li><p>zscore</p></li>
<li><p>zscore-median</p></li>
<li><p>quantile</p></li>
<li><p>power</p></li>
<li><p>robust</p></li>
<li><p>minmax</p></li>
</ul>
<p>The latter four options are obtained via wrappers around the <a class="reference external" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.preprocessing">scikit-learn preprocessing</a> modules.</p>
<p><em>zscore-median</em> is implemented using the following equation:
$X_{norm} = frac{X - median(X)}{median(X)}$</p>
<p>The <em>normalization_time</em> allows to specify a <strong>past</strong> time window that will be used for normalization. The setting specification for <em>raw</em> and <em>feature</em> normalization is specified in the same manner:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;raw_normalization_settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;normalization_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;normalization_method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;median&quot;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this heading"></a></h2>
<p>Features can be enabled and disabled using the <em>features</em> key:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;features&quot;</span><span class="p">:</span>
<span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;fft&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;stft&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;bandpass_filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;sharpwave_analysis&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;raw_hjorth&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;return_raw&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;coherence&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;fooof&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;bursts&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;linelength&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;nolds&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;mne_connectivity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="oscillatory-features">
<h3>Oscillatory Features<a class="headerlink" href="#oscillatory-features" title="Permalink to this heading"></a></h3>
<section id="frequency-band-specification">
<h4>Frequency Band specification<a class="headerlink" href="#frequency-band-specification" title="Permalink to this heading"></a></h4>
<p>Frequency bands are specified in the settings within a dictionary of frequency band names and a list of lower and upper band ranges. The supplied frequency ranges can be utilized by different feature modalities, e.g. fft, coherence, sharpwave etc.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;frequency_ranges_hz&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;theta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mi">4</span><span class="p">,</span>
<span class="w">        </span><span class="mi">8</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;alpha&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mi">8</span><span class="p">,</span>
<span class="w">        </span><span class="mi">12</span>
<span class="w">    </span><span class="p">],</span>
</pre></div>
</div>
</section>
<section id="fft-and-stft">
<h4>FFT and STFT<a class="headerlink" href="#fft-and-stft" title="Permalink to this heading"></a></h4>
<p>Fast Fourier Transform and Short-Time Fourier Transform are both specified using the same settings parametrization:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;fft_settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;windowlength_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;log_transform&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;kalman_filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>log_transform</em> is here a recommended setting.</p>
</section>
<section id="kalman-filtering">
<h4>Kalman filtering<a class="headerlink" href="#kalman-filtering" title="Permalink to this heading"></a></h4>
<p><strong>kalman_filter</strong> can be enabled for all oscillatory features and is motivated by filtering estimated band power features using the white noise acceleration model (see <a class="reference external" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6927801/">“Improved detection of Parkinsonian resting tremor with feature engineering and Kalman filtering”</a> Yao et al 19) for a great reference. The white noise acceleration model get’s specified by the <span class="math notranslate nohighlight">\(T_p\)</span> prediction interval (Hz), and the process noise is then defined by <span class="math notranslate nohighlight">\(\sigma_w\)</span> and <span class="math notranslate nohighlight">\(\sigma_v\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}Q = \begin{bmatrix} \sigma_w^2 \frac{T_p^{3}}{3} &amp; \sigma_w^2 \frac{T_p^2}{2}\\
   \sigma_w^2 \frac{T_p^2}{3} &amp; \sigma_w^2T_p\ \end{bmatrix}\end{split}\]</div>
<p>The settings can be specified as follows:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;kalman_filter_settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Tp&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;sigma_w&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.7</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;sigma_v&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;frequency_bands&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;low gamma&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;high gamma&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;all gamma&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Individual frequency bands (specified in the <em>frequency_ranges_hz</em>) can be selected for Kalman Filtering (see <a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/20172805/">Chisci et al ‘10</a> for an example).</p>
</section>
<section id="bandpass-filter">
<h4>Bandpass filter<a class="headerlink" href="#bandpass-filter" title="Permalink to this heading"></a></h4>
<p><strong>bandpass_filter</strong> enables band power feature estimation through precomputation of a FIR filter using the <a class="reference external" href="https://mne.tools/dev/generated/mne.filter.create_filter.html">mne.filter.create_filter</a> function.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;bandpass_filter_settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;segment_lengths_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;theta&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;alpha&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;low beta&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">333</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;high beta&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">333</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;low gamma&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;high gamma&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;HFA&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;bandpower_features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;activity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;mobility&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;complexity&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;log_transform&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;kalman_filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <em>segment_length_ms</em> parameter defines a time range in which FIR filtered data is used for feature estimation. In this example, for the theta frequency band the previous 1000 ms are used to estimate features based on the FIR filtered signal. This might be beneficial when using shorter frequency bands, e.g. gamma, where estimating band power in a range of e.g. 100 ms might result in a temporal more specified feature calculation.
A common way to estimate band power is to take the variance of FIR filtered data. This is equavilent to the activity <a class="reference external" href="https://en.wikipedia.org/wiki/Hjorth_parameters">Hjorth</a> parameter. The Hjorth parameter <em>activity</em>, <em>mobility</em> and <em>complexity</em> can be computed on bandpass filtered data as well. For estimating all Hjorth parameters of the raw unfiltered signal, the <strong>raw_hjorth</strong> method can be enabled.</p>
</section>
<section id="analyzing-temporal-waveform-shape">
<h4>Analyzing temporal waveform shape<a class="headerlink" href="#analyzing-temporal-waveform-shape" title="Permalink to this heading"></a></h4>
<p><strong>sharpwave_analysis</strong> allows for calculation of temporal sharpwave features. See <a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/S1364661316302182">“Brain Oscillations and the Importance of Waveform Shape”</a> Cole et al 17 for a great motivation to use these features. Here, sharpwave features are estimated using a prior bandpass filter  between within the <em>filter_low_cutoff</em> and <em>filter_high_cutoff</em> ranges. The sharpwave peak and trough features can be calculated, defined by the <em>estimate</em> key. According to a current data batch one or more temporal waveform events can be detected. The subsequent feature is returned rather by the <em>mean, median, maximum, minimum or variance</em> as defined by the <em>estimator</em>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;sharpwave_analysis_settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;sharpwave_features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;peak_left&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;peak_right&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;trough&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;width&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;prominence&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;decay_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;rise_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;sharpness&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;rise_steepness&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;decay_steepness&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;slope_ratio&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;filter_ranges_hz&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="mi">5</span><span class="p">,</span>
<span class="w">            </span><span class="mi">80</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="mi">5</span><span class="p">,</span>
<span class="w">            </span><span class="mi">30</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;detect_troughs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;estimate&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;distance_troughs_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;distance_peaks_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;detect_peaks&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;estimate&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;distance_troughs_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;distance_peaks_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;estimator&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;mean&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;interval&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;median&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;max&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;prominence&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;sharpness&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;min&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;var&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;apply_estimator_between_peaks_and_troughs&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A separate tutorial on sharpwave features is provided in the documentation.</p>
</section>
</section>
<section id="raw-signals">
<h3>Raw signals<a class="headerlink" href="#raw-signals" title="Permalink to this heading"></a></h3>
<p>Next, raw signals can be returned, specifed by the <strong>return_raw</strong> method. This can be useful for using e.g. normalizing, rereferencing or resampling before feeding data to a deep learining model.</p>
</section>
<section id="characterization-of-spectral-aperiodic-component">
<h3>Characterization of spectral aperiodic component<a class="headerlink" href="#characterization-of-spectral-aperiodic-component" title="Permalink to this heading"></a></h3>
<p>There is also a wrapper around the <a class="reference external" href="https://fooof-tools.github.io/fooof/">**fooof*</a> toolbox for characterizing the periodic and aperiodic fits. The periodic components will be reuturned with a <em>peak_idx</em>, the respective center frequency, bandwith, and height over the aperiodic component can be returned. fooof specific parameters, e.g. <em>knee</em> or <em>max_n_peaks</em> are passed to the fooof object as well:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;fooof&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;aperiodic&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;exponent&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;periodic&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;center_frequency&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;band_width&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;height_over_ap&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;windowlength_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;peak_width_limits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mf">0.5</span><span class="p">,</span>
<span class="w">        </span><span class="mi">12</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;max_n_peaks&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;min_peak_height&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;peak_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;freq_range_hz&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="mi">40</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;knee&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="nonlinear-measres-for-dynamical-systems-nolds">
<h3>Nonlinear measres for dynamical systems (nolds)<a class="headerlink" href="#nonlinear-measres-for-dynamical-systems-nolds" title="Permalink to this heading"></a></h3>
<p><strong>nolds</strong> <a href="#id1"><span class="problematic" id="id2">*</span></a>eatures are estimates as a direct wrapper around the nolds toolbox: <a class="reference external" href="https://github.com/CSchoel/nolds">https://github.com/CSchoel/nolds</a>. Features can be estimated for raw data, or data being filtered in different frequency bands. The computations time for this feature modality is however very high. For real time applications it is currently not advised.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;nolds_features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;sample_entropy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;correlation_dimension&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;lyapunov_exponent&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hurst_exponent&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;detrended_fluctutaion_analysis&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;raw&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;frequency_bands&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;theta&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;low beta&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;high beta&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;low gamma&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;high gamma&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;HFA&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="coherence">
<h3>coherence<a class="headerlink" href="#coherence" title="Permalink to this heading"></a></h3>
<p><strong>coherence</strong> can be calculated for channel pairs that are passed as a list of lists. Each list contains the in <em>nm_channels</em> specified channels. The mean and/or maximum in a specific frequency band can be calculated for a specific frequency band. The maximum for all frequency bands can also be estimated:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;coherence&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;channels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;STN_RIGHT_0&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;ECOG_RIGHT_0&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;frequency_bands&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;high beta&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;mean_fband&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;max_fband&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;max_allfbands&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;coh&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;icoh&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="bursts">
<h3>Bursts<a class="headerlink" href="#bursts" title="Permalink to this heading"></a></h3>
<p><strong>bursting</strong> features are strongly investigated in the context of invasive electrophysiology. Here different burst features for different frequency bands with a different time duration for threshold estimation can be specified:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;burst_settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">75</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;time_duration_s&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;frequency_bands&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;low beta&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;high beta&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;low gamma&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;burst_features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;duration&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;amplitude&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;burst_rate_per_s&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;in_burst&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="mne-connectivity">
<h3>MNE-connectivity<a class="headerlink" href="#mne-connectivity" title="Permalink to this heading"></a></h3>
<p><strong>MNE-connectivity</strong> is a direct wrapper around the mne_connectivity <a class="reference external" href="https://mne.tools/mne-connectivity/stable/generated/mne_connectivity.spectral_connectivity_epochs.html">spectral_connectivity_epochs</a> function.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;mne_connectiviy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;plv&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;multitaper&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="postprocessing">
<h2>Postprocessing<a class="headerlink" href="#postprocessing" title="Permalink to this heading"></a></h2>
<section id="projection">
<h3>Projection<a class="headerlink" href="#projection" title="Permalink to this heading"></a></h3>
<p><strong>projection_cortex</strong> and <strong>projection_subcortex</strong> allows feature projection of individual channels to a common subcortical or cortical grid, defined by <em>grid_cortex.tsv</em> and <em>subgrid_cortex.tsv</em> files. For both projections a <em>max_dist_mm</em> parameter needs to be specified, in which data is linearly interpolated, weighted by their inverse grid point distance.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;project_cortex_settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;max_dist_mm&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
<span class="p">},</span>
<span class="nt">&quot;project_subcortex_settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;max_dist_mm&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="example_BIDS.html" class="btn btn-neutral float-left" title="ECoG Movement decoding example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="example_sharpwave_analysis.html" class="btn btn-neutral float-right" title="Analyzing sharpwave temporal features" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Timon Merk.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>